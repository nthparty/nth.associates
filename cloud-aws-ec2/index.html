<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Nth Party, Ltd.">
    <meta name="author" content="Nth Party, Ltd.">
    <title>Nth Party | nth.associates</title>
    <link href="//fonts.googleapis.com/css2?family=Montserrat:wght@500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css"
          integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
    <script>
var favIcon = "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";
var docHead = document.getElementsByTagName('head')[0];
var newLink = document.createElement('link');
newLink.rel = 'shortcut icon';
newLink.type = 'image/x-icon';
newLink.href = 'data:image/png;base64,'+favIcon;
docHead.appendChild(newLink);
    </script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
          integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.7.2/min/dropzone.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.7.2/basic.min.css" rel="stylesheet">
    <script src="libsodium-wrappers-sumo.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
html { height:100vh; font-family:'Montserrat',sans-serif; font-size:14px; }
body { display:flex; flex-direction:column; min-height:100vh; }

body > #topbar { border-bottom:1px solid #e5e5e5; }
body > #topbar > #title { white-space:nowrap; }
body > #topbar > #title > #logo { display:inline-block; margin-top:-30px; padding-right:10px; margin-right:10px; border-right:1px solid #3d1733; cursor:pointer; }
body > #topbar > #title > #name { display:inline-block; font-size:25px; color:#d49d48; position:relative; top:3px; font-family:'Montserrat',sans-serif; cursor:pointer; }
body > #topbar > #title > #name > b > sub { padding-left:3px; font-size:12px; color:#317b82; }
body > #topbar > nav > .tagline { margin-left:60px; font-family:'Montserrat',sans-serif; font-size:17px; color:#3d1733; }

body > .main { margin-bottom:60px; }
body > .container { max-width:1160px; }
body > .container > .card-deck > .card { min-width:330px; border-bottom-left-radius:20px; border-top-right-radius:20px; }
body > .container > .card-deck > .card a { color:#d49d48; }
body > .container > .card-deck > .card a:hover { color:#d49d48; }
body > .container > .card-deck > .card > .card-header { padding-top:16px; border-top:1px solid #B092A8; border-left:1px solid #B092A8; border-right:1px solid #B092A8; border-bottom:1px solid #CCCCCC; border-top-right-radius:20px; background-color:#EEEEEE; text-align:left; }
body > .container > .card-deck > .card > .card-header h4 { margin-bottom:4px; font-family:'Montserrat',sans-serif; font-size:20px; color:#d49d48; }
body > .container > .card-deck > .card > .card-header h4 .card-header-step-check { display:none; color:#317b82; font-weight:bold; }
body > .container > .card-deck > .card > .card-header h4 .card-header-step-warning { display:none; color:#FF0000; font-weight:bold; }
body > .container > .card-deck > .card > .card-header h5 { margin-bottom:5px; font-family:'Montserrat',sans-serif; font-size:19px; color:#3d1733; }
body > .container > .card-deck > .card > .card-header h5 span { font-size:20px; color:#3d1733; }
body > .container > .card-deck > .card > .card-header table { width:100%; }
body > .container > .card-deck > .card > .card-header td { padding-left:6px; padding-right:6px; text-align:center; vertical-align:middle; }
body > .container > .card-deck > .card > .card-header #drop-hidden-input { display:none; }
body > .container > .card-deck > .card > .card-body { border:1px solid #B092A8; border-top:0px solid #000000; border-bottom-left-radius:20px; padding-top:30px; padding-bottom:24px; background-color:#FFFFFF; text-align:center; }
body > .container > .card-deck > .card > .card-body-step { padding-bottom:110px; }
body > .container > .card-deck > .card > .card-body-step > img { height:90px; margin-top:8px; margin-bottom:30px; }
body > .container > .card-deck > .card > .card-body > .card-body-message { font-family:'Montserrat',sans-serif; font-size:14px; }
body > .container > .card-deck > .card > .card-body > .card-body-action { position:absolute; left:0px; bottom:26px; width:100%; text-align:center; }
body > .container > .card-deck > .card > .card-body > .card-body-action .button { padding:10px 24px 10px 24px; border-radius:5px; font-size:16px; }
body > .container > .card-deck > .card > .card-body > .card-body-action .button-disabled { cursor:not-allowed; }
body > .container > .card-deck > .card > .card-body > .sheet { display:inline-block; margin-top:10px; }
body > .container > .card-deck > .card > #card-other { background-color:#E5E3E7; }
body > .container > .card-deck > .card > .card-body .sheet-self { display:none; }
body > .container > .card-deck > .card > .card-body > #preview { display:none; text-align:middle; }
body > .container > .card-deck > .card > .card-body > #preview > table { display:inline; }
body > .container > .card-deck > .card > .card-body > #preview > table > tr > td { border:1px solid #CCCCCC; padding:0px 4px 0px 4px; font-size:11px; }
body > .container > .card-deck > .card > .card-body > #preview > table .row-number { background-color:#EEEEEE; padding:0px 16px 0px 16px; font-size:14px; }
body > .container > .card-deck > .card > .card-body > #preview > table .row-operation { background-color:#EEEEEE; padding:0px 0px 0px 0px; font-size:10px; }
body > .container > .card-deck > .card > .card-body > #preview > table .row-operation div { padding:5px 16px 5px 16px; }
body > .container > .card-deck > .card-step-one { display:none; opacity:0.5; }
body > .container > .card-deck > .card-step-two { display:none; opacity:0.5; }
body > .container > .card-deck > .card-data { display:none; }
body > .container > .card-deck > .card-step-complete { opacity:0.5 !important; }
body > .container > .card-deck > .card-step-complete > .card-header { background-color:#BAD8D2; }
body > .container > .card-deck > .card-step-complete > .card-body { background-color:#D7EDE9; }
body > .container > .card-deck > .card-step-complete:hover { opacity:1 !important; }
body > .container > .card-deck > .card-step-complete:hover > .card-header { }
body > .container > .card-deck > .card-step-complete:hover > .card-body { }
body > .container > .card-deck > .card-step-warning > .card-header { background-color:#E3C6CC; }
body > .container > .card-deck > .card-step-warning > .card-body { background-color:#F6E3E7; }

body > footer { width:100%; margin:auto auto 0 auto; padding:16px; background-color:#3d1733; }
body > footer a { color:#d49d48; }
body > footer a:hover { color:#d49d48; }
body > footer > .container { width:100%; padding:0px; color:#d49d48; font-family:'Montserrat',sans-serif; }
body > footer .card-deck { margin-bottom:0px !important; }
body > footer .card { margin-bottom:0px !important; border:0px; background-color:#3d1733; }
body > footer .card-deck-copyright { height:40px; font-size:10px; }
body > footer .card-copyright { height:40px; }
body > footer .card-body-links { padding-top:8px; }
body > footer .card-body-links-internal { float:left; }
body > footer .card-body-links-external { float:right; }
body > footer .link { margin:0px 25px 0px 0px; white-space: nowrap; font-size:14px; }
body > footer .icon { margin:0px 15px 0px 0px; font-size:18px; }
body > footer .icon-last { margin:0px 0px 0px 0px; font-size:18px; }

.box-shadow { box-shadow:0 .25rem .75rem rgba(0, 0, 0, .05); }
label { display:inline; font-family:'Montserrat',sans-serif; font-size:14px; }
input { display:inline; font-size:14px; padding:3px; }
input:disabled { cursor:not-allowed; }
button { display:inline; padding:5px 4px 3px 4px; border:1px solid #333333; background-color:#3d1733; color:#FFFFFF; font-family:'Montserrat',sans-serif; font-size:14px; font-size:14px; }
button:hover { background-color:#d49d48; }
.button { font-family:'Montserrat',sans-serif; font-size:14px; background-color:#3d1733; color:#FFFFFF; padding:5px 10px 3px 10px; border:1px solid #727577; }
.button:hover { background-color:#d49d48; }
.button:disabled, .button[disabled] { background-color:#787878; color:#DDDDDD; }
input[type=checkbox] { margin:8px; }
.noselect {
  -webkit-touch-callout:none; /* iOS Safari */
    -webkit-user-select:none; /* Safari */
     -khtml-user-select:none; /* Konqueror HTML */
       -moz-user-select:none; /* Old versions of Firefox */
        -ms-user-select:none; /* Internet Explorer/Edge */
            user-select:none; /* Non-prefixed version, currently
                                 supported by Chrome, Edge, Opera and Firefox */
}
#data-preview-description { margin-top:-7px; margin-bottom:7px; }

.data_op_join { background-color:#FFDFAA; }
.data_checkbox_cell { padding:0px; cursor:pointer; }
.data_checkbox_cell > div { display:flex; width:100%; min-height:50px; }
.data_checkbox_cell > div > input { margin:auto; }
.data_cell { vertical-align:bottom; }
.exclude-first-row-toggle-div { margin-bottom:-7px; }
.exclude-first-row-toggle-div > table > tr > td { border:0px; text-align:left; }
.exclude-first-row-toggle-div > table input { margin:0px; cursor:pointer; }
.exclude-first-row-toggle-div > table label { padding-right:3px; font-size:8px; cursor:pointer; }
.first-row-checkbox-label { padding-bottom:7px; }
.data_row_first_cell_excluded { background-color:#EEEEEE !important; }

.tooltip-arrow { background-color:#3d1733; cursor:pointer; }
.tooltip > .tooltip-inner { padding:12px; background-color:#3d1733; font-family:'Montserrat',sans-serif; font-size:10px; cursor:pointer; }

.modal { height:100%; }
.modal-container-lg > .modal-dialog { display:table; position:relative; height:100%; margin:0 auto; }
.modal-container-lg > .modal-dialog > .modal-content { min-width:400px; height:100%; border:none; background-color:transparent; }
.modal-container-lg > .modal-dialog > .modal-content > table { height:100%; }
.progress { display:none; height:30px; width:100%; }
.progress-bar { background-color:#d49d48; }
#progress-message { display:none; margin-top:10px; text-align:center; color:#FFFFFF; font-family:'Montserrat',sans-serif; font-size:16px; }
.modal-card-deck { display:none; }
.modal .card-deck > .card { min-width:500px; min-height:240px; border-bottom-left-radius:20px; border-top-right-radius:20px; border:0px; }
.modal .card-deck > .card > .card-header { padding-top:16px; border-top:1px solid #B092A8; border-left:1px solid #B092A8; border-right:1px solid #B092A8; border-bottom:0px solid #000000; border-top-right-radius:20px; background-color:#EEEEEE; text-align:left; }
.modal .card-deck > .card > .card-header h4 { margin-bottom:4px; font-family:'Montserrat',sans-serif; font-size:20px; color:#d49d48; }
.modal .card-deck > .card > .card-header h4 .card-header-step-check { display:none; color:#317b82; font-weight:bold; }
.modal .card-deck > .card > .card-header h4 .card-header-step-warning { display:none; color:#FF0000; font-weight:bold; }
.modal .card-deck > .card > .card-header h5 { font-family:'Montserrat',sans-serif; font-size:20px; color:#3d1733; }
.modal .card-deck > .card > .card-header h5 span { font-size:20px; color:#3d1733;  }
.modal .card-deck > .card > .card-header table { width:100%; }
.modal .card-deck > .card > .card-header td { padding-left:6px; padding-right:6px; text-align:center; vertical-align:middle; }
.modal .card-deck > .card > .card-body { border:1px solid #B092A8; border-top:0px solid #000000; border-bottom-left-radius:20px; padding-top:30px; padding-bottom:24px; background-color:#FFFFFF; text-align:center; }
.modal .card-deck > .card > .card-body > .card-body-message { font-family:'Montserrat',sans-serif; font-size:14px; }
.modal .card-deck > .card > .card-body > .card-body-action { position:absolute; left:0px; bottom:26px; width:100%; text-align:center; }
.modal .card-deck > .card > .card-body > .card-body-action .button { padding:10px 24px 10px 24px; border-radius:5px; font-size:16px; }
.modal .card-deck > .card > .card-body > .card-body-action .button-disabled { cursor:not-allowed; }

@media all and (max-width:1096px) {
  body > #topbar > nav > .tagline { font-size:14px; }
  body > .container > .card-deck > .card > .card-header h5 { font-size:18px; }
  body > .container > .card-deck > .card > .card-header h5 span { font-size:18px; }
  .card-copyright > .card-body { text-align:center; }
  footer .card-body-links-internal { display:block; float:none; width:100%; text-align:center; margin-bottom:30px; }
  footer .card-body-links-internal .link { margin-right:10px; margin-left:10px; font-size:12px; }
  footer .card-body-links-external { display:block; float:none; width:100%; text-align:center; }
}

@media all and (max-width:767px) {
  body > #topbar > nav > .tagline { display:none; }
  #topbar { padding-bottom:0px !important; }
}
    </style>
    <!--social-media-sharing-css-->
  </head>
  <body onload="app.initialize();">

    <!-- Loading/waiting/progress/warning/error/message modal. -->
    <div class="modal fade modal-container-lg" data-backdrop="static" data-keyboard="false" tabindex="-1" style="height:100%">
      <div class="modal-dialog modal-sm" style="height:100%">
        <div class="modal-content" style="height:100%">
          <table><tr><td>
            <div class="card-deck mb-3 text-center modal-card-deck">
              <div class="card mb-4 box-shadow">
                <div class="card-header">
                  <h4 class="noselect card-header-title"></h4>
                  <h5 class="noselect"><span class="card-header-subtitle"></span></h5>
                </div>
                <div class="card-body">
                  <div class="card-body-message noselect">
                    <div class="card-body-message-content">
                    </div>
                  </div>
                  <div class="card-body-action">
                    <input type="button" id="card-modal-action-button" class="button" value="Okay" onclick="app.modal.hide();"/>
                  </div>
                </div>
              </div>
            </div>

            <!--span class="fa fa-spinner fa-spin fa-3x"></span-->
            <div class="progress">
              <div id="progress-overall-bar" class="progress-bar progress-bar-striped progress-bar-animated"
                   role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%">
              </div>
            </div>
            <div id="progress-message" class="noselect"></div>
          </td></tr></table>
        </div>
      </div>
    </div>

    <!-- Title and navigation menu. -->
    <div id="topbar" class="d-flex flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 bg-white box-shadow">
      <h5 id="title" class="my-0 mr-md-auto font-weight-normal">
        <div id="logo" class="noselect" onclick="window.location = 'https://nthparty.com';">
          <img src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAFoAAAAoCAIAAADxIHqfAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAABOPSURBVHjaYvz//z8DbgCU/fHt+/fvP9jYWLl4uJmYmBiIABBdP378YGFh5eLmZGZhIajl79+/tZnlj+8+YOfk6Fk4WUBYkGEgAEAA4XTos0dPz584u27Rqvs37/76+YuRiVFZQ6W4pVLXRB+Pcf/+/du/dc/GpWuvXbgKDBEGRkZBYUFHb5e47CQRCVG4sj+/f+9ct+3bt2/sHBweQd5s7Gw/vv04c+Tk00dPRZGU0R8ABBAjWuoA+ufkgWOr5684ceDYx/cfWIDxy8YKkfr2+auWoc6SvWs4ODmwmvXq+cvuqrZd67f/+/uPnYMNGBYgA//++/b1m56pQd/iKTIKshCVb1+98TFyffvqtayi/Oazu4Dp7tWzl2G2fu/fvldQVVpxcD0nF+eABAdAAKGkjtOHT8yfMPvEwWO/f/1iZWNjYWYGMoCeAsYhUJaLl/vZ42cvn76QV1HANOj2tZsVyUXXL13j4eUBhunP7z+A6Z+RkREYdvxC/FfOXuwsa560ciYjOIzevX7LzMQENFZcShySAd+/e//79x+gRhExYaDGU4dOvHz2QlFNSdtAF5gw6RYcAAEEDY4Hd+7P6poKjNifP38CPfD7PwM7O7upi726rsaZo6cvnjwLDB2gMlZWFmYWZqxhURCV9fjeQx4+3u9fvgmJCrkFemroan3++Gnrqk3PHz8Dih/Zc+jwzgN2Ho7b12ye3j759+/fQIuAUomekW6BXnpmhn///AEmxs+fPueFp188c/7Prz9sbGzhqTElrRV0Cw6AAGL5+ePHvAmz5/ZO//ThE7+QADCVsrCyuAZ4xmYmaBpoQxJ2klf04/uPmMCAnYMdzQhgNFamFj+69xCoFxjn0ZlxcTnJUnLSEFn3QK/s0NQ3L1///vlr39bdwOC4ev7KhXPnJCWkmJmZgfnx5t3remZGKl++/v71G5gx7928++XTZ0YmJm4ebmBiWTJtvrWLraWjNX2CAyCAmL5/+yEqLpJUkGZgYQx0EDCh8vLxJealQMICCITFRLSNdIG55j/Df6AH0AoOYNHTVd5y/cJVLm6u///+AesFSRkpHj4euAIVLbXA2BBgomNlZ7ty9hLQh8qaqkamJkCLgNbJKSsEBIeY2Vt+ePsBaAXIwH//Xfzc43OSefn5mJiZfv74efHUebqlDoAAYhIQEghJjMyqLpi7ZbGprfmf33+ePX46saEHWREwp/wH+5yDC73WXDZz0a6NO7iB5cXff3/+/AXmju7q9nC7gAsnz8HVGFubAqMaWAS8fv4SWPQExoQExoZ+//oNWMR6BHtPWzPX2cf15bPnf/78+fH9h4Wj1cRlMyq6ar1Dfb99+QosaoDFEN2CAyCAEO0IYGyEJ0exsDADc+z5k+eAuQMu9e0r0FmMwHgD+ooFqey4duHKjI7JwCbJL1DRy6ploMPJxQXMMo/uPuir6fj75y9EmaSsNChN/Wf49fsPMOsBRT68e//v33+gUQJC0PYFMHWAk8Y/G1d7SPHEJyQAVANkIKc1WgOAAEJpVgHdDalEgOn26cMn8Ozw9fMXJiZgcPwDBhkLLHUAk/qEuq4P7z4AawRlddWpq+cs3bcmPjcJmLw5ubluXbt158ZtiEpgPmJiZgZXun+/f/sG8TzQQGAICsKaWx/evweWF8AMJSoObXd8ev8RmDSABRm/EP2aZAABhK2VyQhsJv359OEjtL345+/Xz8DUwQTM9vyC/BCPAcHq+cuP7z8GLFyV1JQnLptmaGkMzhdmoELk/39gNfHmxWtoo+vPH0jr5j+skQPMU0CNQM53YFMNrODju49MjIysrKz8iPQCDiBWVgFBAboFB0AAoQQHsMAD+pmRAQSZGBlhzec/wKIeGJlAKXjbGZh2FkycAyzqgBVNZU+djKIcPCGAkvp/oAEMjDCzv3z6AgwdIANUEoNTHzD9A4tSYMxPauoLtfEFtkp+fPvGCA4OYFkG0QWsdIBuYAEFEP2CAyCAUIIDWJIBS0RgLAIbYMCWIqxBDQyOL5DUISgsBBGcP3E2MESAnozLSTK3t0J0Pf78/Q/K8P+ZWVmBNRQ0noFNrF+/GcApn0+AHyji4ucBrIO+ffkGbIyePXrq7LEzwJoYWHACyyCI54GtEmCT5CtQ5OcvYJKkW3AABBBKNQEs6oGRBnQ3yDP8UM98+/YdmGqAaQWYdCGp4+Kpc1tXbgSKGFmZJhemo6SvHz+AoQbMBcB4BjbG4Mke6D1gkgEmJUERkAk2rnZ9i6ZsWbnx47sPopJiOka6nz981DHRBwYWPyRr/GcAtlA09bWBsSImJUGqr+5cu7Vp2XpgOg1JjJCWlyFeI0AAoQbHl6/ArAGsSoFlPi8/LzSpf/wETAXAGAfWIMA2CFBkXv/sjx8+8vLy5tYWAktNZBOArRhggAKLCE4uDn5BeLL/COyzAdOXkIgwBye0MwLs1wERXCNyEgNX7ax5dcVkR/Lls5cmtfbx8fF7hviQpBEggNCC4xswtYODgwWeOj5//AzML5DWh6Ss1IkDRw/v2g+MPf+YYFNbCzTjgFUyKL/8/ycoIszGDm2/AktloAlAM0XERUGN2v//r56/DKyA5FUUgeH74PY9YEsUaKmyujK8DIIDoN67N+4A+zjAxAis+FQ01eBdSmB9d+f6LSBDTVsDWCFev3gVWMYBW4xAXwC7C9xcXILCAp8+fnp45wEwk0rISN68fOPHt69CoiLAXiKaLQ/v3H/94pWYpDhAALGgewaYWcDNLXifEhQcwILwPwMwYoFl4dzemcAkIK+skJifihm6nz98+gMuNYVEhODuBhaKoLoG2D0DV6IfP3zKj8wEdl7Ty7KfPHy8fc0WoAeALgamRzt3x/z6YnFpSaCyu9dvL5o67+ieQ29evvn18ycwvIDltIa+VmlbNTBzgZLAmYu5Eem8fLxFzeXAfHd072FgMzIiNaYmowxcWvMCq63skBRggWhuZzFr06LFU+dtWLwG2Piev30Zctv63Zu3BdHZNy9f61kwESCAmNBSB7iP/59PgA/oPli98AlSLwC7qkd2Hzx77DQzM7BjEg9MKZjB8eH9B2C+ALZQBEWEGGF1EzCzAKtVYKMDMuQBLEq+f/8BbKTOmzBr5dxl4pLilk7WwKY9sBxZt3BVaWI+sBoGKju+/+icqdOBpbiOkZ6zr5uGriawWD118Hh1WgkwKEGd4LfvgMH07du3ttLG/dv2cHJyyinJA9OgjIIssJUMjFdgkgF2AhRUFRQ1VEAFlosdEwvzras3gOGI7OYNS9ZcPnMBWE65BnoBBBBK6oDUdqDmFh+iuQXJLMD0Aky3a+avABaKWka6QfGhWPPeB5BDUapkUHC8+8AI7saLiIlCm6TA8uUfkPhb1V0flhwFTInAIJhQ3712wcrTh06uW7wa2Gdx9ff49KHRK9QXnrZndE6e2Tn13q27Jw8cA7buP7z7CKwHf/34xcPL3TytC1gS8fLxsHGw23s4lScXblq2ztjKdNKKmcAUzQCOF3MHK2CxCsw7h3YdAKYjiJnAPLJ63gpgdQ5M7MDiHyCAUFPH1+/A4ABWDDz8vPDmFrDHDeyMAMWBtSAw8oGmx+ckcfNgbzgDEx4w7QCzBry5CXTxx3fvgdqBRYmwuAgkdID1LtC0mKyE+NxkSK4EFlX5DaXA3h2wzD518ARQRFxaIqsqHxgWQNOA4QsU8Q7zB2YooF5grQw2BzREAqyEStqqwpIjRSVEgXEGDHZgugP2zoHmAFMosKgCJnNI1AKzKrBnDDTs2J5DwEoD1phccfvqTVMbM7dALyAXIIBQyw5g6gA2FkGpA+HbLx8/g+o9YKQzMgKdYmZn4RHkg2uI9N3rd0ATWJgY4S0UYGoCNuTBwQFtgL9/9x5YH/MJ8gO9h6wdmEOVNVSBvV5gWQNMOMBw3L5m85E9h549evoLVNODBu5+/foNrOC4ebkhKRHoVGkFWScfN2RzgI4E5iMgA+4GOHDycQVWwMCSG9jSsXWzf3T34eq5y4DxkViQCnQeUAFAAKGkju+gHiQwqf8H5j1EcHz+wggesAK6Bpg0wlOisY4AQd3x5h24cckGzyzA4ADmMpAgG7AlgkgdwMQCLG7RQhNYNfxn+A/s1/39/acqraQsqQBY0AL7vpxgAKyzgL1mYAUnAPYnMKkCEzKw0OHi4UJ1xi9ggALzB2ZzFph95JTlv375cnjXASB35dylD+8+sHaxc/R2hSgACCBE6gANaoKDA5ickPPCty9fIA12YNWoZ2rg4OmEq9IGugOYWYDJFehzeFsb6MMfP34CGUD/C4L9DwwOcDn1/fH9h0KiwnDtwKrkyvnLwOaJkaUJMFFsXrEB2E7pnNdv6+YAdBuwQ3Bwx/7C6Cxg4ocYDjEH6Ge08X1gYffj2w+gMszUAaxurJ3trl+8du7Y6Qsnz21btZmPny82OxFe6gMEEBPS0P4fYKOYCTwwycXLjZQ6voJyEDgD+0cHQUYJsQJgKgCPnqN0Q4GOBtU1//8D29qQ6g00Is3KAqzU5/TOBBZM0CG1py86ypvfgCp/Ma8wX2Aj4s+vX8DAAgYNyJXMIHce2XMQWLkAUzUk6X0ABwdmBw9oMrCyB2ftn9B+4z/E8Li9hyOwAHr+5FlLYd3Lp8/tPZ2AqQMuCxBAiNQBLC+/glMHsBDlgrU1gUEAGqpjZARaAKzGgHkPT5MOWHAAcwEwOEH9LlhHAxQcvyDBIQBpiQC9AbQCmFj2bNoBTCDAQh7oyeP7jjy+94iVnTWrMl9CWlJcSgLY0AA6uqemw9HLGZhst6/esn/7HlDRyAJMHYJALcAaCuhRfozgEBEXA9Y1wLhZPmsJ0ElAP7sGejp4OkNk9c0MldVUbl27eef6bWBPEpg0kPUCBBALcu8L1O5gZAQWEPA2GLCKhXTGgTnFytkWmHrxBAewAPsN8jkDsNsK7wECcziw/AcGB68AHyRVA1MHUJm1sy0woe3dvPPc6TOgmoWLV1FdOb0sB5gAwZWI34kDx3Zv3DF/8ixg8wkYR6paavYezrvWbxMQEQS2gD59/Pjuzbvff3/zwDoTcACMiYS81L7aztvXbl64eO4fwz8RCTF4cABrHwdv5+uXrgLd6RrgaWJjjqwXIIBYkLqz34HFHiOoG87EycUFH6oAZkVg+mdjYzO0MMbf4Id21UC1Ji+82fIJ3GEBJldIqx9UzgHTy58/SurKpe3VB7bvu3npGjApK6gqmttbwnM7sCvUPrsX2A+4fuEqUIuknLSjpzOwqW7lbANs1wNTGTs7R2V3LTCSMDsKQBCVEadlpHP2yCmgAllFeWtXO2RZBRVFYPbn4uKMzUpA0wgQQCzI/TdgwwicUZk5uTnhPVRgwQ6sZ4Glt7K6CoHgACWE36ysLMCKCV77QNr4wOgFtqaBXGAihxT7wMQC5AILZlxlM9DPtq72QAQXAZbEwIYJrFDkCYgOweMYAzMjIIJznz58AiwBgCYAs9jqBSuAlUtAdDCwZkDTBRBALEid0e9/wcHBDCo7uFE6LOB6AdgTxx8cwA4LsAr4zwKKW2ZEK+4TuDz7B2ksAA389hXUuuGn4xgXsNtSl1X+6vlLQ0uTa+evXDx9QU1bPbU0C1MlQACxoAx2gAd7gRELL0q/fIIEx39gGcaOYy4SERzgQTNgDQRMh/CqC9iKYwR1WP5BhgKADZPfP0FNKQE6joA+ffj46aOnwOb5tQtXgbWbgblhbX+zLEbvGQgAAggpdXz99g+WOjgRwfEF3GEHjdwQnL7/BquSOZBmWEGVN7Atw8gA0Q4sBXoWTQKytQx16BYcwMbukj2rzx0/AyzdgHWWsbUpDx8vVpUAAcSCPhQGDg5uWL0ATx3AyoKZmUBwfP/+HTL/gDxTB8kawFYNkAFqJggJ2LjaA0s4YCcSWOfhacVQFwA7LG4BngSVAQQQC8bYDzOwjQQvSr9+Bo36gupObk54pw4XANbKwBzyj+E/pP0PAcDABWYfYLkIrCOAeRiIDu7Yt2DibGArBq2SGwwAIIBY0MZ+QNUKFxe8mgQmdWAYAdM2J3jsB79ZwFAA5hRG8NoVuKC2oc621ZuAzZBTh06E2fgB08WLJ8+/fvkcHB/OMPgAQAAxIWdyyDAnuJqEj/18+QMWBFa08NIRFxCVEAOaANT75P5j+LIR/+hgbUNdyMKIJw8ev3n1GljcKmmougZ4DMLgAAggJuSCENYw/wtsHUDYwGYyM7h0hDfM8ACgt4FlASsr68VT58+fOAttIwoJyCkrgPIRuFMLTGjAwiilKEOc9PFxOgCAAGJBnYhlArY+H919kOIbA2ynA/uFj+49BKZzYAuNmOU4Fo5WskryT+4/ArYyajLK/KICGRkYD+7cf+vyDUhVBUw7379+T8hLDkuOYhiUACCAWJDHNYCN8f8M///9/X8D2HAGpnbwtBhomPPfP/iEAB4AbFkBo702qxxYygB7qJMae4GCwFoG2IQDLZ77Dup059QUpJfnMAxWABBASMHxCVRqQuYQmJiY4YMgoPFIYMOJnagaMSAm+NP7D9M7J39895EdXDcDzQQWQEDtBmaG6RW5wJ4bwyAGAAGEWCoHbLp9/vCZEeiB33+YmJmAnXRgpw400woeAQFmdcicEzHgzcvXR3YfPLL7ELCPCyw7gF0DKycbFU01ItdhDiAACDAAywhW+FfA774AAAAASUVORK5CYII=" alt="Nth Party"/>
        </div>
        <div id="name" class="noselect" onclick="return 0;"><b>nth.associates<sub id="version"></sub></b></div>
      </h5>
      <nav class="my-2 my-md-0 mr-md-3">
        <div class="tagline noselect"></div>
      </nav>
    </div>

    <br/><br/>

    <div class="container main">

      <div class="card-deck mb-3 text-center">
        <div class="card mb-4 box-shadow card-step-one">
          <div class="card-header">
            <h4 class="noselect">Step 1 <span class="card-header-step-check card-step-one-checkmark">&check;</span></h4>
            <h5 class="noselect"><span class="card-header-subtitle">Load and encrypt your data</span></h5>
          </div>
          <div class="card-body card-body-step">
            <img src="1.svg"/>
            <div id="drop-hidden-input"></div>
            <div class="card-body-message noselect">
              <div class="card-body-message-content">
                Choose data to contribute or use
                <select name="data-random" id="data-random">
                  <option value="" disabled selected>&lt;choose&gt;</option>
                </select>
                rows of simulated data.
              </div>
            </div>
            <div class="card-body-action">
              <form action="/" id="chooseFile">
                <div class="dz-default dz-message">
                  <button id="card-step-one-action-button" class="dz-button button" type="button">Click or drop CSV file</button>
                </div>
              </form>
            </div>
          </div>
        </div>
        <div class="card mb-4 box-shadow card-step-two">
          <div class="card-header">
            <h4 class="noselect">Step 2 <span class="card-header-step-check card-step-two-checkmark">&check;</span></h4>
            <h5 class="noselect"><span class="card-header-subtitle">Evaluate and enrich your data</span></h5>
          </div>
          <div class="card-body card-body-step">
            <img src="2.svg"/>
            <div class="card-body-message">
              <div id="card-body-message-contributor-container">
                <div class="card-body-message-content noselect">Click below to encrypt your data, perform secure analysis and enrichment, and review your results</div>
              </div>
            </div>
            <div class="card-body-action">
              <input type="button" id="card-step-two-action-button" class="button button-disabled" value="Encrypt and analyze/enrich" onclick="app.contribute();" disabled/>
            </div>
          </div>
        </div>
      </div>

      <div class="card-deck mb-3 text-center">
        <div class="card mb-4 box-shadow card-data">
          <div class="card-header">
            <h5 id="card-data-header-content" class="noselect">Preview your data contribution</h5>
          </div>
          <div class="card-body">
            <div class="card-body-message noselect" id="data-preview-description">A preview of your data contribution will appear here.</div>
            <div class="sheet" id="sheet-self"></div>
            <div id="preview" class="noselect"></div>
          </div>
        </div>
      </div>
    </div>

    <footer class="text-muted">
      <div class="container">
        <div class="card-deck mb-3">
          <div class="card mb-4">
            <div class="card-body card-body-links">
              <div class="card-body-links-internal">
              <span class="link"><b><a href="https://nthparty.com">Nth Party, Ltd.</a></b></span>
              <span class="link"><a href="https://nthparty.com/contact-us">Contact Us</a></span>
              </div>
              <div class="card-body-links-external">
                <span class="icon"><a href="https://linkedin.com/company/nth-party"><i class="fab fa-linkedin"></i></a></span>
                <span class="icon"><a href="https://twitter.com/nthparty"><i class="fab fa-twitter"></i></a></span>
                <span class="icon"><a href="https://medium.com/nthparty"><i class="fab fa-medium"></i></a></span>
                <span class="icon-last"><a href="https://github.com/nthparty"><i class="fab fa-github"></i></a></span>
              </div>
            </div>
          </div>
        </div>
        <div class="card-deck mb-3 card-deck-copyright">
          <div class="card mb-4 card-copyright">
            <div class="card-body noselect">
              &copy; Copyright 2021 Nth Party, Ltd. All rights reserved.
            </div>
          </div>
        </div>
      </div>
    </footer>

    <!-- Bootstrap core JavaScript placed at the end of the document for faster loading. -->
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
            integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script>
/*
 * Overall application.
 */
function App(config) {

  /* Dependencies. */

  var require = function (m) { if (!(m in window)) throw new Error('cannot load ' + m); };

  // External.
  require('jQuery');
  require('Dropzone');
  require('Papa');
  require('sodium');

  // Internal.
  require('Session');
  require('State');
  require('Data');
  require('Sheets');
  require('Cards');
  require('Buttons');
  require('Modal');
  require('Progress');
  require('Channel');

  /* Internal object attributes. */

  this.config = config;
  this.io = null;
  this.sheets = new Sheets(this);
  this.progress = new Progress();
  this.session = null;
  this.state = null;
  this.cards = null;
  this.buttons = null;
  this.modal = null;

  /* Methods. */

  var self = this; // Self-reference for use in method implementations.

  this.mapAsyncWithProgress = function (fn, arr, index, arr_, portion) {
    index = (index == null) ? 0 : index;
    arr_ = (arr_ == null) ? [] : arr_;
    var portion = (portion == null) ? 1000 : portion;
    var i = null;

    for (i = index; i < arr.length && (i - index) < portion; i++) {
      let res = fn(arr[i]);
      if (res != null)
        arr_.push(res);
    }
    self.progress.advanceByLength(i - index);

    return new Promise(function (resolve) {
      if (i < arr.length) {
        setTimeout(function () {
          self.mapAsyncWithProgress(fn, arr, i, arr_).then(resolve);
        }, 100);
      } else {
        resolve(arr_);
      }
    });
  };

  this.stages = async function (stage) {
    var roles = ["contributor", "recipient"];

    // Add the initial data from this contributor to the database if this
    // is the first time this function has been invoked.
    if (stage === 0) {
      // Initialize progress tracking modal.
      let data = self.state.dataSelf();
      self.progress.message("Preparing data for encryption.");

      // Create a protocol session data structure and prepare
      // the data (i.e., transforming and hashing as necessary).
      self.session = new Session(self, self.state, roles);
      let prepared = await self.session.prepareSelfData(data);

      self.progress.setLength(self.session.data.points.length * 6);

      var req = {
        "data@cli;masked@cli": {}
      };

      self.progress.message("Encrypting data for analysis.");

      // Encrypt the data using own mask.
      req["data@cli;masked@cli"] = await self.mapAsyncWithProgress(self.session.protocol.maskEncode, self.session.data.points);

      // Display the encrypted data for the user.
      self.sheets.self.data(req["data@cli;masked@cli"], true);

      self.progress.message("Contributing encrypted data and awaiting encrypted results.");
      const response = await self.io.give({
        msg: {"step_one": req},
        update_progress: true
      });
      let reply = await response.json();

      self.progress.message("Saving encrypted results from service.");
      let lookup = {};
      await self.mapAsyncWithProgress(function(row) {
        var key = self.session.protocol.decode(row[0]);
        lookup[key] = [row[4], row[5]];
      }, reply["data@srv;masked@srv"]);

      let res = [];
      for (var i = 0; i < reply["data@cli;masked@cli;masked@srv"].length; i++) {
        var row = reply["data@cli;masked@cli;masked@srv"][i];
        var key = self.session.protocol.decodeUnmask(row[0]);
        var val = lookup[key];
        if (val != null) {
          data[i] = data[i].concat(val);
          res.push(data[i]);
        }
      }

      //self.sheets.self.data(res);

      var scalar_two = sodium.crypto_core_ristretto255_scalar_random();
      var scalar_for_keys = sodium.crypto_core_ristretto255_scalar_random();
      var scalar_for_keys_inv = sodium.crypto_core_ristretto255_scalar_invert(scalar_for_keys);
      var req_two = {
        "data@srv;masked@srv;masked@cli": [],
        "data@cli;masked@cli": []
      };

      self.progress.message("Shuffling encrypted results received from service.");
      req_two["data@srv;masked@srv;masked@cli"] = await self.mapAsyncWithProgress(function(row) {
        var v = sodium.to_base64(
            sodium.crypto_scalarmult_ristretto255(
              scalar_two,
              sodium.from_base64(row[0], 1)
            )
            ,
            1
        );
        var k = sodium.to_base64(
            sodium.crypto_scalarmult_ristretto255(
                scalar_for_keys,
                sodium.from_base64(row[3], 1)
            )
            ,
            1
        );
        return [v, k];
      }, reply["data@srv;masked@srv"]);

      self.progress.message("Preparing to request keys to decrypt results.");
      var cli_masked_point_to_data = {};
      var i = 0;
      await self.mapAsyncWithProgress(function(point) {
        var v =
          sodium.to_base64(
            sodium.crypto_scalarmult_ristretto255(scalar_two, point),
            1
          );
        cli_masked_point_to_data[v] = data[i];
        req_two["data@cli;masked@cli"].push(v);
        i++;
      }, self.session.data.points);

      self.progress.message("Waiting for decryption keys that can decrypt results.");
      const response_two = await self.io.give({
        msg: {"step_two": req_two},
        update_progress: true
      });
      let reply_two = await response_two.json();

      self.progress.message("Decrypting the results.");
      let res_f = await self.mapAsyncWithProgress(function(row) {
        var dat = cli_masked_point_to_data[row[0]];
        var sec_key =
            sodium.crypto_scalarmult_ristretto255(
                scalar_for_keys_inv,
                sodium.from_base64(row[1], 1)
            );

        try {
          var nonce_g_gender = sodium.from_base64(dat[3], 1);
          var nonce_g = nonce_g_gender.slice(0, 24);
          var g = nonce_g_gender.slice(24);
          dat[3] = sodium.to_string(sodium.crypto_secretbox_open_easy(g, nonce_g, sec_key));
        } catch (err) {
          dat[3] = "";
        }

        try {
          var nonce_a_age = sodium.from_base64(dat[4], 1);
          var nonce_a = nonce_a_age.slice(0, 24);
          var a = nonce_a_age.slice(24);
          dat[4] = sodium.to_string(sodium.crypto_secretbox_open_easy(a, nonce_a, sec_key));
        } catch (err) {
          dat[4] = "";
        }
        return dat;
      }, reply_two["final"]);

      self.sheets.self.data(res_f, false, true);

      self.cards.complete(".card-step-two", "#card-step-two-action-button");
      $("#card-data-header-content").html("View your enriched data");

      const result_count = res_f.length;
      var correct = 0;
      for (var i = 0; i < res_f.length; i++) {
        correct += (res_f[i][1] == res_f[i][3] && res_f[i][2] == res_f[i][4]) ? 1 : 0;
      }

      const percentage = (100 * correct) / self.session.data.points.length;
      self.cards.message(
        ".card-step-two",
        '<span class="percentage">' + percentage.toFixed(3) + "%</span> " +
        '<span class="count">' +
          "or <b>" + correct + "</b> of the " +
          "<b>" + self.session.data.points.length + "</b> entries in your " +
          " data have correct demographic information" +
          " and <b>" + (result_count - correct) + "</b> entries can be enriched or corrected." +
        '</span>'
      );

      self.modal.hide();
    }
  }

  this.initialize = function () {
    // Add version subscript if it is for a preliminary version.
    if (["alpha", "beta"].includes(self.config.version)) {
      $("#version").html(self.config.version);
    }

    setTimeout(async function () {
      await sodium.ready;

      // Parameters: poll interval (ms), max items per query, maximum message size (KB).
      self.io = Channel(self);

      // Create instances of interface component APIs.
      self.cards = new Cards(self);
      self.buttons = new Buttons(self);
      self.data = new Data(self);
      self.modal = new Modal(self);

      // Configure the UI component for choosing a CSV file.
      if ($("#chooseFile").length) {
        var dropzone = new Dropzone("#chooseFile", {
          "autoProcessQueue": false,
          "autoQueue": false,
          "hiddenInputContainer": "#drop-hidden-input",
          "previewTemplate": '<span style="display:none"></span>',
          "createImageThumbnails": false
        });
        dropzone.on("addedfile", function(file) {
          // Display progress modal.
          self.modal.showProgress("Loading CSV file into browser.", 0);

          // Only allow CSV files to be loaded.
          if (!file.name.endsWith(".csv")) {
            self.modal.showCard(
              "Error",
              "Non-CSV file selected",
              "The selected file <b>" + file.name + "</b> is not a CSV file. " +
                 "Please select a valid CSV file."
            );
            return;
          }

          // Only allow CSV files to be loaded.
          if (file.size == 0) {
            self.modal.showCard(
              "Error",
              "CSV file is empty",
              "The selected file <b>" + file.name + "</b> has no rows. " +
                 "Please select a CSV file that contains at least one row."
            );
            return;
          }

          // If maximum CSV file size is an expression string, evaluate it.
          if (!Number.isInteger(self.config.maximumCSVFileSize)) {
              var factors = self.config.maximumCSVFileSize.split("*");
              self.config.maximumCSVFileSize = 1;
              for (var i = 0; i < factors.length; i++) {
                  self.config.maximumCSVFileSize *= parseInt(factors[i].trim());
              }
          }

          // Limit maximum size of allowed CSVs.
          if (file.size > self.config.maximumCSVFileSize) {
            self.modal.showCard(
              "Error",
              "CSV file is too large",
              "The selected file <b>" + file.name + "</b> is over 50 MB in size. " +
                "Please select a smaller CSV file."
            );
            return;
          }

          // Load the file.
          var reader = new FileReader();
          reader.readAsText(file);
          reader.onload = function(event) {
            // Parse the CSV.
            var csvData = event.target.result.trim();
            var data = [], stepCount = 0, chunksParsed = 0;
            var capRows = self.config.maximumCSVRowCount, capReached = false;
            Papa.parse(
              csvData,
              {
                worker: true, // Disable if using `setTimeout()` approach.
                chunkSize: 1024 * 1024, // Disable if using `setTimeout()` approach.
                chunk: function (results, parser) {
                  if (results && results.data) {

                    stepCount += results.data.length;
                    if (stepCount > capRows) {
                      capReached = true;
                      let rowsLeft = capRows - data.length;
                      data.push.apply(data, results.data.slice(0, rowsLeft));
                      parser.abort();
                    } else {
                      chunksParsed++;
                      data.push.apply(data, results.data);
                      self.progress.setPercent(Math.ceil((100 * 1024 * 1024 * chunksParsed) / file.size));
                    }

                  }
                },
                complete: function (results) {
                  // Record a reference to the data and move on to the next step.
                  self.state.dataSelf(data);
                  self.cardStepTwo();

                  // Update the progress bar.
                  self.progress.setPercent(100);

                  // Display message if data has been cut off due to the
                  // cap on the number of rows being reached.
                  if (!capReached) {
                    self.modal.hide();
                  } else {
                    self.modal.showCard(
                      "Warning",
                      "CSV Row Limit",
                      "Your selected CSV file <b>" + file.name + "</b>" +
                        " has more than " +capRows + " rows." +
                        " <b>Only the first " + capRows + " rows have been loaded.</b>"
                    );
                  }
                },
                error: function () {
                  self.modal.showCard(
                    "Error",
                    "Loading and Parsing CSV File",
                    "There was an error loading or parsing the CSV file you chose."
                  );
                }
              }
            );
          };
          reader.onerror = function() {
            self.modal.showCard(
              "Error",
              "Cannot read file",
              "The selected file <b>" + file.name + "</b> cannot be read."
            );
          };
        });
      }

      // Contributor is waiting for session to be validated.
      self.progress.setPercent(75);

      // Create an initial state.
      self.state = new State(self);

      // Adjust and show cards and card content for this role.
      self.cards.message(
        ".card-step-one",
        ('Choose CSV file to contribute to the analysis or ' +
          '<a id="simlink" href="javascript:void(0)" onclick="app.simulatedLinkClick();"><b>click here</b></a> ' +
          'to use sample data. ')
      );

      self.cards.activate(".card-step-one");
      self.cards.introduce([
        ".card-step-one",
        ".card-step-two",
        ".card-step-three"
      ]);

      // Input/output spreadsheets.
      $("#sheet-self").show();
      self.sheets.initialize();
      $("#sheet-self").hide();

    }); // Wait for sodium to load.
  };

  this.cardStepTwo = function () {
    $("#data-random").prop("disabled", true);
    self.cards.complete(".card-step-one", "#card-step-one-action-button");
    self.cards.activate(".card-step-two");
    self.cards.introduce([".card-data"]);
    self.buttons.enable("#card-step-two-action-button");
  }

  this.simulated = function () {
    self.cardStepTwo();
  };

  this.simulatedLinkClick = function () {
    $("#simlink").prop("onclick", null).off("click");
    self.sheets.selfSelectRandomData('data-client.json');
    self.simulated();
  };

  this.contribute = function () {
    self.modal.showProgress("Gathering data for encryption.", 0);
    setTimeout(async function () { self.stages(0); }, 250);
  };
}


/*
 * Component with methods for common operations involving
 * button user interface components.
 */
function Buttons(app) {

  /* Dependencies. */

  var require = function (m) { if (!(m in window)) throw new Error('cannot load ' + m); };

  // External.
  require('jQuery');

  /* Internal object attributes. */

  this.app = app; // Reference to overall application object.

  /* Methods. */

  var self = this; // Self-reference for use in method implementations.

  this.enable = function (query) {
    $(query).prop("disabled", false);
    $(query).removeClass("button-disabled");
  }

  this.disable = function (query) {
    $(query).prop("disabled", true);
    $(query).addClass("button-disabled");
  }

  this.label = function (query, text) {
    $(query).prop("value", text);
  }
}


/*
 * Component with methods for common operations involving
 * content card user interface components.
 */
function Cards(app) {

  /* Dependencies. */

  var require = function (m) { if (!(m in window)) throw new Error('cannot load ' + m); };

  // External.
  require('jQuery');

  /* Internal object attributes. */

  this.app = app; // Reference to overall application object.

  /* Methods. */

  var self = this;

  this.introduce = function (queries) {
    for (var i = 0; i < queries.length; i++) {
      $(queries[i]).fadeIn();
      $(queries[i]).css("display", "flex");
    }
  }

  this.activate = function (query) {
    $(query).css("opacity", 1);
  }

  this.complete = function (queryCard, queryButton) {
    // Set card properties to reflect that task is
    // complete.
    $(queryCard).removeClass("card-step-warning");
    $(queryCard).addClass("card-step-complete");
    $(queryCard + "-warning").css("display", "none");
    $(queryCard + "-checkmark").css("display", "inline");

    // If a button to disable is specified, disable it.
    if (queryButton != null) {
      self.app.buttons.disable(queryButton);
    }
  }

  this.completeAndRemain = function (queryCard, queryButton) {
    // Set card properties to reflect that task is
    // complete, but do not fade it out (e.g., in
    // case it is the last step).
    self.complete(queryCard, queryButton);
    $(queryCard).css({"cssText": "opacity: 1 !important; display: flex;"});
  }

  this.warning = function (query) {
    $(query).addClass("card-step-warning");
    $(query + "-warning").css("display", "inline");
  }

  this.subtitle = function (query, html) {
    $(query).find(".card-header-subtitle").html(html);
  }

  this.message = function (query, html) {
    $(query).find(".card-body-message-content").html(html);
  }
}


/**
  * API for interacting with back-end.
  */
function Channel(app) {

  /* Dependencies. */

  var require = function (m) { if (!(m in window)) throw new Error('cannot load ' + m); };

  /* Internal attributes. */

  this.app = app;

  /* Methods. */

  var self = this; // Self-reference for use in method implementations.

  async function give(data) {
    return fetch('/enrich', {
      method: 'POST',
      headers: {"Content-type": "application/json"},
      body: JSON.stringify(data.msg)
    });
  }

  /* Publicly accessible methods. */
  var exports_ = {};
  exports_.give = give;
  return exports_;
};


/*
 * Component for managing the user-specified data workflow operations,
 * including management of user interface components.
 */
function Data(app) {

  /* Dependencies. */

  var require = function (m) { if (!(m in window)) throw new Error('cannot load ' + m); };

  // External.
  require('jQuery');

  /* Internal object attributes. */

  this.app = app; // Reference to overall application object.
  this.__columnCount = null;
  this.__rowFirstExclude = null;
  this.__columnJoin = null;

  /* Methods. */

  var self = this; // Self-reference for use in method implementations.

  this.setColumnCount = function (value) {
    self.__columnCount = value;
  }

  this.rowFirstExclude = function () {
    return self.__rowFirstExclude;
  }

  this.columnJoin = function () {
    return self.__columnJoin;
  }

  this.clickFirstRowData = function () {
    $(".first-row-checkbox-data").prop("checked", true);
    $(".first-row-checkbox-header").prop("checked", false);
    self.__rowFirstExclude = false;
    $(".data_row_first_cell").removeClass("data_row_first_cell_excluded");
  };

  this.clickFirstRowHeader = function () {
    $(".first-row-checkbox-data").prop("checked", false);
    $(".first-row-checkbox-header").prop("checked", true);
    self.__rowFirstExclude = true;
    $(".data_row_first_cell").addClass("data_row_first_cell_excluded");
  };

  this.toggleIndependentCell = function (op, column) {
    var id = "#data_" + op + "_checkbox_" + column;
    $(id).prop("checked", !$(id).is(':checked'));
    self.toggleIndependent(op, column, false);
  }

  this.toggleIndependent = function (op, column, direct) {
    var id = "#data_" + op + "_checkbox_" + column;

    // Ignore a direct click to avoid conflict with cell click.
    if (direct) {
      $(id).prop("checked", !$(id).is(':checked'));
    }

    if ($(id).is(':checked')) {
      // Uncheck all other checkboxes for the same operator (i.e., in same row).
      for (var c = 0; c < self.__columnCount; c++) {
        if (c != column) {
          $("#data_" + op + "_checkbox_" + c).prop("checked", false);
          $(".data_" + op + "_checkbox_" + c + "_cell").removeClass("data_op_" + op);
        }
      }

      // Add the highlight for the operation being toggled.
      $(".data_" + op + "_checkbox_" + column + "_cell").addClass("data_op_" + op);
    } else {

    }
  }

  this.toggleCell = function (op, column) {
    var id = "#data_" + op + "_checkbox_" + column;
    $(id).prop("checked", !$(id).is(':checked'));
    self.toggle(op, column, false);
  }

  this.toggle = function (op, column, direct) {
    var id = "#data_" + op + "_checkbox_" + column;

    // Ignore a direct click to avoid conflict with cell click.
    if (direct) {
      $(id).prop("checked", !$(id).is(':checked'));
    }

    if ($(id).is(':checked')) {
      // Update internal state.
      if (op == 'join') {
        this.__columnJoin = column;
      }

      // Uncheck all other checkboxes in the same column that are not
      // independent.
      $(".data_checkbox_" + column).not(id).not(".data_independent_checkbox").prop("checked", false);

      // Uncheck all other checkboxes for the same operator (i.e., in same row).
      for (var c = 0; c < self.__columnCount; c++) {
        if (c != column) {
          $("#data_" + op + "_checkbox_" + c).prop("checked", false);
          $(".data_column_" + c).removeClass("data_op_" + op);
          $(".data_" + op + "_checkbox_" + c + "_cell").removeClass("data_op_" + op);
        }
      }

      // Clear existing highlights for non-independent operators in the
      // selected column.
      $(".data_column_" + column).removeClass("data_op_join");
      $(".data_join_checkbox_" + column + "_cell").removeClass("data_op_join");

      // Add the highlight for the operation being toggled.
      $(".data_" + op + "_checkbox_" + column + "_cell").addClass("data_op_" + op);
      $(".data_column_" + column).addClass("data_op_" + op);
    } else {
      // Indicate the disabled operation in the state.
      if (op == 'join') {
        this.__columnJoin = null;
      }

      // Remove highlights.
      $(".data_join_checkbox_" + column + "_cell").removeClass("data_op_" + op);
      $(".data_column_" + column).removeClass("data_op_" + op);
    }
  }
}

/*
 * Component with methods for managing the modal.
 */
function Modal(app) {

  /* Dependencies. */

  var require = function (m) { if (!(m in window)) throw new Error('cannot load ' + m); };

  // External.
  require('jQuery');

  /* Internal object attributes. */

  this.app = app; // Reference to overall application object.
  this.__shown = false;

  /* Methods. */

  var self = this; // Self-reference for use in method implementations.

  this.showCard = function (title, subtitle, content) {
    self.__shown = true;

    $(".progress").css("display", "none");
    $("#progress-message").css("display", "none");
    $(".modal").find(".card-header-title").html(title);
    $(".modal").find(".card-header-subtitle").html(subtitle);
    $(".modal").find(".card-body-message-content").html(content);
    $(".modal-card-deck").css("display", "flex");
    $(".modal").modal("show");
  }

  this.showProgress = function (content, percent) {
    self.__shown = true;

    $(".modal-card-deck").css("display", "none");
    self.app.progress.setPercent(percent);
    self.app.progress.message(content);
    $(".progress").css("display", "flex");
    $("#progress-message").css("display", "block");
    $(".modal").modal("show");
  }

  this.hide = function () {
    self.__shown = false;

    $(".modal").modal("hide");
    setTimeout(function () {
      if ($(".modal").hasClass("show")) {
        self.hide();
      } else {
        self.app.progress.reset();
      }
    }, 250);
  }
}


/*
 * Encapsulated component for managing a progress bar user
 * interface component (and associated HTML content containers).
 */
function Progress(length) {

  /* Dependencies. */

  var require = function (m) { if (!(m in window)) throw new Error('cannot load ' + m); };

  // External.
  require('jQuery');

  /* Internal object attributes. */

  this.length = length;
  this.index = 0;

  /* Methods. */

  var self = this; // Self-reference for use in method implementations.

  this.setPercent = function (percent) {
    $("#progress-overall-bar").css("width", percent+"%").attr("aria-valuenow", percent);
  };

  this.setLength = function (length) {
    self.length = length;
    self.index = 0;
    self.setPercent(0);
  };

  this.reduceLengthBy = function (length) {
    self.length -= length;
    self.setPercent(Math.floor((100 * self.index) / self.length));
  };

  this.advanceByLength = function (delta) {
    delta =  (delta == null) ? 1 : delta;
    self.index += delta;
    self.setPercent(Math.floor((100 * self.index) / self.length));
  };

  this.advanceByPercent = function (delta) {
    delta =  (delta == null) ? 1 : delta;
    self.index += (delta * self.length) / 100;
    percent = Math.floor((100 * self.index) / self.length);
    self.setPercent(Math.floor((100 * self.index) / self.length));
  };

  this.message = function (text) {
    $("#progress-message").text(text);
  }

  this.reset = function () {
    self.message("");
    self.setPercent(0);
  }
}


/*
 * Encoding/decoding and cryptographic primitives for protocol.
 */
function Protocol(app, state) {

  /* Dependencies. */

  var require = function (m) { if (!(m in window)) throw new Error('cannot load ' + m); };

  // External.
  require('sodium');

  /* Internal object attributes. */

  this.app = app;

  this.encode_small = sodium.to_base64;
  this.decode_small = sodium.from_base64;
  this.encode_fast = sodium.to_hex;
  this.decode_fast = sodium.from_hex;

  this._mask =
    (state.protocolMask() != null) ?
    state.protocolMask() :
    sodium.crypto_core_ristretto255_scalar_random();
  this._maskInv =
    sodium.crypto_core_ristretto255_scalar_invert(this._mask);

  /* Methods. */

  var self = this; // Self-reference for use in method implementations.

  this.encode = function (point) {
    return btoa(String.fromCharCode.apply(null, point)); // self.encode_small(point); 
  };

  this.decode = function (str) {
    return new Uint8Array(atob(str).split("").map(function (c) { return c.charCodeAt(0); })); // self.decode_small(str);
  };

  this.strToPoint = function (s) {
    // Hash to a point.
    var h = sodium.crypto_hash_sha512(sodium.from_string(s));
    return sodium.crypto_core_ristretto255_from_hash(h);
  };

  this.mask = function (point) {
    return sodium.crypto_scalarmult_ristretto255(self._mask, point);
  };

  this.maskEncode = function (point) {
    return self.encode(self.mask(point));
  };

  this.unmask = function (point) {
    return sodium.crypto_scalarmult_ristretto255(self._maskInv, point);
  };

  this.decodeUnmask = function (encodedPoint) {
    return self.unmask(self.decode(encodedPoint));
  };

  this.deduplicateStrs = function (ss) {
    var dss = [];
    for (var i = 0; i < ss.length; i++) {
      if (dss.indexOf(ss[i]) == -1) {
        dss.push(ss[i]);
      }
    }
    return dss;
  };

  this.arrayOfStrToStr = function (a) {
    // Apply the various column operations if they are enabled.
    var columnJoin = self.app.data.columnJoin();
    var v = (columnJoin == null) ? a.join("") : a[columnJoin];
    return v;
  };
}


/*
 * Encapsulated session state (for an individual session) and methods
 * to create payloads for each step in a session.
 */
function Session(app, state, selfRoles) {

  /* Dependencies. */

  var require = function (m) { if (!(m in window)) throw new Error('cannot load ' + m); };

  // Internal.
  require('Protocol');

  /* Internal object attributes. */

  this.app = app;
  this.state = state;
  this.roles = selfRoles;
  this.other = { // State of other contributor.
    "data": {},
    "roles": []
  }
  this.protocol = new Protocol(app, state);

  /* Methods. */

  var self = this; // Self-reference for use in method implementations.

  this.prepareSelfData = async function (data) {
    // Turn rows into strings, deduplicate them, and hash them to points.
    let arrayOfStrs = data.map(self.protocol.arrayOfStrToStr);

    // Exclude first row if it is designated as a header row by the user.
    if (self.app.data.rowFirstExclude()) {
      arrayOfStrs.shift();
    }

    let ss = self.protocol.deduplicateStrs(arrayOfStrs);
    let points = await self.app.mapAsyncWithProgress(self.protocol.strToPoint, ss);

    self.data = {
      "clear": data,
      "points": points
    };

    return true;
  };
}


/*
 * Internal state and methods for spreadsheet-like user interface
 * component instances.
 */
function Sheet(app, elementId, data) {

  /* Dependencies. */

  var require = function (m) { if (!(m in window)) throw new Error('cannot load ' + m); };

  // External.
  require('jQuery');

  /* Internal object attributes. */

  this.app = app;
  this.data = data;
  this.elementId = elementId;

  /* Methods. */

  var self = this; // Self-reference for use in method implementations.

  this.settings = function (data) {
    return {};
  };

  this.table_operation_row = function (table_element, column_count, op, op_html, tooltip) {
    var tr = document.createElement("tr");
    var td_row = document.createElement("td");

    if (tooltip == null) {
      td_row.innerHTML = op_html;
    } else {
      td_row.innerHTML =
        '<div data-toggle="tooltip" data-html="true" title="' +
        tooltip +
        '">' + op_html + '</div>'
        ;
    }

    td_row.classList.add("row-operation");
    tr.appendChild(td_row);
    for (var c = 0; c < column_count; c++) {
      var td = document.createElement("td");
      var toggle = "app.data.toggle('" + op + "', " + c + ", true);";
      td.classList.add("data_" + op + "_checkbox_" + c + "_cell");
      td.classList.add("data_checkbox_cell");
      td.innerHTML =
        '<div ' +
        (
          'data-toggle="tooltip" data-html="true"' +
          'title="' + tooltip + '"'
        ) +
        ' style="width:100%; height:100%;">' +
        '<input type="checkbox"' +
        ' class="data_checkbox_' + c + '"' +
        ' id="data_' + op + '_checkbox_' + c + '"' +
        ' onclick="' + toggle + '" ' +
        '/>' +
        '</div>'
        ;
      const op_ = ''+op, c_ = parseInt(''+c);
      td.onclick = function () { app.data.toggleCell(op_, c_); };
      tr.appendChild(td);
    }
    table_element.appendChild(tr);
  };

  this.data = function (data, encrypted, results) {
    // Is the data being displayed in encrypted form?
    encrypted = (encrypted == null) ? false : encrypted;
    results = (results == null) ? false: results;

    // Convert encrypted data to one-column format.
    var data_ = [];
    if (encrypted) {
      for (var r = 0; r < data.length; r++) {
        data_.push([data[r]]);
      }
      data = data_;
    }

    if (data == null) {
      return self.__data; // No new data was supplied; return current data.
    } else {
      // Update reference to data.
      self.__data = data;

      // Hide the placeholder message.
      if (!results) {
          $("#data-preview-description").html(
            (self.__data.length <= 100)
            ?
            (
              "Shown below are the <b>" + self.__data.length + " " +
              (encrypted ? "encrypted " : "") +
              "entries</b> of your data contribution."
            )
            :
            (
              (!encrypted) ?
                (
                  "Shown below are the <b>first " +
                  "100 entries (of " + self.__data.length +
                  " entries in total)</b> of your data contribution." +
                  //
                  "<br/><b>All " + self.__data.length +  " entries</b> " +
                  "are deduplicated, encrypted, and included in the analysis."
                )
                :
                (
                  "Shown below are the encrypted <b>first " +
                  "100 entries (of " + self.__data.length +
                  " <i>unique</i> entries in total)</b> of your data contribution." +
                  //
                  "<br/><b>All " + self.__data.length +  " unique encrypted entries</b> " +
                  "are included in the analysis."
                )
            )
          );
      } else {
          $("#data-preview-description").html(
            (self.__data.length <= 100)
            ?
            (
              "Shown below are the <b>" + self.__data.length + " " +
              "entries</b> of the enriched results."
            )
            :
            (
              "Shown below are the <b>first " +
              "100 entries (of " + self.__data.length +
              " entries in total)</b> of the enriched results."
            )
          );
      }

      if (self.sheet == null) { // No spreadsheet library; using HTML table.
        // Build preview of at most first 100 rows.
        $("#preview-table").remove();
        var tbl = document.createElement("table");
        tbl.id = "preview-table";
        document.getElementById("preview").appendChild(tbl);

        var column_count = 0;
        if (data.length > 0) {
          column_count = data[0].length;
          self.app.data.setColumnCount(column_count);
        }

        // If this is the non-encrypted data, check the app configuration and
        // show data operation checkboxes that are enabled.
        if (!encrypted && !results) {
          if (self.app.config.operations.join) {
            self.table_operation_row(
              tbl, column_count,
              "join",
              'MATCH USING ONLY<br/>SELECTED COLUMN<br/>(OPTIONAL)',
              (
                "If you select a column, only that column will be used to match a row in your data with a row " +
                "in the service provider's data." +
                "<br/><br/>" +
                "If no column is selected, rows on both sides must match exactly " +
                "(in terms of the columns, the order of the columns, and the values in those columns) " +
                "to contribute to the total overlap."
              )
            );
          }
        }

        // Add data preview.
        for (var r = 0; r < Math.min(100, data.length); r++) {
          var tr = document.createElement("tr");
          var td_row = document.createElement("td");

          if ( r == 0 && !encrypted && !results &&
               "operations" in self.app.config &&
               "toggleFirstRow" in self.app.config.operations &&
               self.app.config.operations.toggleFirstRow
             ) {
            td_row.innerHTML +=
              '<div class="exclude-first-row-toggle-div" data-toggle="tooltip" data-html="true" title="' +
                "If the first row contains column names, exclude it from the analysis by selecting HEADER." +
              '">' +
                '<table><tr><td>' +
                  '<table><tr><td>' +
                    '<input type="checkbox" id="first-row-checkbox-data"' +
                      ' class="first-row-checkbox-data"' +
                      ' onclick="app.data.clickFirstRowData();"'+
                      ' checked/>' +
                  '</td>' +
                  '<td class="first-row-checkbox-label">'+
                    '<label for="first-row-checkbox-data">DATA</label>' +
                  '</td></tr></table>' +
                '</td>' +
                '<td>' +
                  '<table><tr><td>' +
                    '<input type="checkbox" id="first-row-checkbox-header"' +
                      ' class="first-row-checkbox-header"' +
                      ' onclick="app.data.clickFirstRowHeader();"' +
                      '/>' +
                  '</td>' +
                  '<td class="first-row-checkbox-label">' +
                    '<label for="first-row-checkbox-header">HEADER</label>' +
                  '</td></tr></table>' +
                '</td></tr></table>' +
              '</div>'
              + (r + 1);
          } else {
            td_row.innerHTML = r + 1;
          }

          td_row.classList.add("row-number");
          tr.appendChild(td_row);

          // Display plaintext or encrypted data.
          for (var c = 0; c < data[r].length; c++) {
            var td = document.createElement("td");
            td.classList.add("data_column_" + c);
            td.classList.add("data_cell");
            if (r == 0) {
              td.classList.add("data_row_first_cell");
            }
            td.innerHTML = data[r][c];
            tr.appendChild(td);
          }

          tbl.appendChild(tr);
        }
        $("#preview").show();
      }

      // Enable tooltips once element is in the document.
      $('[data-toggle="tooltip"]').tooltip();
    }
  }

  // Create spreadsheet object and populate HTML element.
  data = data == null ? [[""]] : data; // Default data: one cell.
}

/*
 * Encapsulated component for managing multiple spreadsheet-like
 * user interface components.
 */
function Sheets(app) {

  /* Dependencies. */

  var require = function (m) { if (!(m in window)) throw new Error('cannot load ' + m); };

  // External.
  require('jQuery');
  require('_'); // Underscore.js.

  // Internal.
  require('Sheet');

  /* Internal object attributes. */

  this.app = app;

  /* Methods. */

  var self = this; // Self-reference for use in method implementations.

  this.randomDataFraction = function (n) {
    return n; //Math.floor((3 * n) / 5);
  };

  this.selfSelectRandomData = function (value) {
    
    // Use selection unless a parameter was provided.
    value = (value == null) ? $("#data-random").val() : value;

    fetch(value)
      .then(response => {
        if (!response.ok) {
          throw new Error("HTTP error " + response.status);
        }
        return response.json();
      })
      .then(data => { // The `data` result is a JSON object.
        // Sample the raw data (above 50% ensures a non-empty intersection).
        data = _.sample(data, self.randomDataFraction(data.length));
        self.app.state.dataSelf(data);

        // Show and populate the data preview table.
        self.self.data(data);
      })
      .catch(function () {
        // Should report a connectivity issue.
      });
  };

  this.initialize = function () {
    // Create spreadsheets.
    self.self = new Sheet(self.app, "sheet-self");

    // Add event handlers to user interface components
    // if they are present.
    if ($("#data-random").length) {
      $("#data-random").change(function () {
        self.selfSelectRandomData();
        self.app.clear();
        self.app.simulated();
      });
    }
  };
}


/*
 * Internal state of an application (including party identifiers, analysis
 * attributes/toggles, persistent protocol credentials and cryptographic
 * material, and other information).
 */
function State(app) {

  /* Dependencies. */

  var require = function (m) { if (!(m in window)) throw new Error('cannot load ' + m); };

  // External.
  require('jQuery');
  require('sodium');

  /* Internal object attributes. */

  // Reference to overall application object.
  this.app = app;

  // Cryptographic configuration.
  this.__protocolMask = sodium.crypto_core_ristretto255_scalar_random();

  // The in-memory copy of the data as an array of arrays.
  this.__dataSelf = null;

  // Other information.
  this.__dataOtherLength = 0; // Initialized to work smoothly in all cases.

  /* Methods. */

  var self = this; // Self-reference for use in method implementations.

  this.protocolMask = function (value) {
    if (value == null) {
      return self.__protocolMask;
    } else {
      self.__protocolMask = value;
    }
  };

  this.dataSelf = function (value) {
    if (value == null) {
      return self.__dataSelf;
    } else {
      self.__dataSelf = value;

      // Show and populate the data preview table.
      self.app.sheets.self.data(self.__dataSelf);
    }
  };
}

const app = new App({
  "version": "alpha",
  "tagline": "",
  "maximumCSVFileSize": "50 * 1024 * 1024",
  "maximumCSVRowCount": 100000,
  "operations": {
    "toggleFirstRow": true,
    "join": true
  }
});
    </script>
  </body>
</html>
